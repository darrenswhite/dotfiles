#!/bin/bash

_RESET="\001$(tput sgr0)\002"
_REV="\001$(tput rev)\002"

BLUE=111
GREEN=79
ORANGE=215
PINK=219
PURPLE=129

function __ps_bg() {
  echo "\001$(tput setab "${1}")\002"
}

function __ps_fg() {
  echo "\001$(tput setaf "${1}")\002"
}

function __ps_chunk() {
  local fg=${1}
  local chunk=${2}
  local bg=${3}
  local output=''

  output+="${_RESET}"
  output+="$(__ps_fg "${fg}")"
  output+="${_REV}"
  output+="${chunk}"
  output+="${_RESET}"

  if [ -n "${bg}" ]; then
    output+="$(__ps_arrow "${fg}" "${bg}")"
  fi

  echo "$output"
}

function __ps_arrow() {
  local output=''
  local fg=${1}
  local bg=${2}

  output+="${_RESET}"
  output+="$(__ps_fg "${fg}")"

  if [ -n "${bg}" ]; then
    output+="$(__ps_bg "${bg}")"
  fi

  output+=""
  output+="${_RESET}"

  echo "$output"
}

function __git_branch() {
  __git_ps1 "%s"
}

function __git_branch_ps() {
  local output=''
  local branch

  branch="$(__git_branch)"

  if [ -n "${branch}" ]; then
    output+="$(__ps_arrow ${ORANGE} ${PURPLE})"
    output+="$(__ps_chunk ${PURPLE} "  ${branch} ")"
    output+="$(__ps_arrow ${PURPLE})"
  else
    output+="$(__ps_arrow ${ORANGE})"
  fi

  echo -e "${output}"
}

timestamp="$(__ps_chunk ${PINK} ' \t ' ${BLUE})"
user="$(__ps_chunk ${BLUE} ' \u ' ${GREEN})"
hostname="$(__ps_chunk ${GREEN} ' \H ' ${ORANGE})"
working_dir="$(__ps_chunk ${ORANGE} ' \w ')"
branch="\$(__git_branch_ps)"
ps2="\n${_RESET}$(__ps_fg ${PINK})└──»» ${_RESET}"

export PS1="${timestamp}${user}${hostname}${working_dir}${branch}${ps2}"
